{
  "name": "Making a RESTful API using Python and Flask",
  "tagline": "",
  "body": "### Purpose\r\n\r\nCan you teach a computer to recognize the brand logos in an unlabeled feed of images from Instagram?\r\n\r\nIn a [previous project](chriskaschner.com/retraining), I created a Convolutional Neural Network (CNN) that can identify brand logos (specifically Nike and Altra) in untagged/ unlabeled photos from a social media feed.  The model I used implemented a [previously trained](https://github.com/tensorflow/models/tree/master/inception) network and [transfer learning](https://en.wikipedia.org/wiki/Inductive_transfer).\r\n\r\nFor this project I wanted to build a REST API that allowed me to send requests to that neural network and store its results in JSON.\r\n\r\nFortunately, I also had the opportunity to develop a solution for a GapJumpers Challenge [available here](https://www.gapjumpers.me/questions/return-path/qs-323/)\r\n\r\nThe challenge specifies the following for a successful submission:\r\n\r\n- Write a simple Rest API with PHP, Node.js, Ruby, Python or Go.\r\n- Your API must have:\r\n\t- at least three endpoints\r\n\t- all endpoints must be linked in some way\r\n- Pay careful attention to REST best practices\r\n- Describe the application in detail in a design document including why you chose the approach you did.\r\n- include tests that validate success.\r\n\r\n### Deliverables\r\n- Using Python and Flask, I created this website- [a single page](https://chriskaschner.github.io/restful-api-flask/) that allows for retrieval of data from my endpoints.  The 3 endpoints are described in detail in the API Documentation section below.\r\n- In order to share my application and provide links where it can be tested - links and curl embeds are included throughout this document that allow for interacting with the API directly.  The API is currently live at [http://10la.pythonanywhere.com/img/api/v1.0/images](http://10la.pythonanywhere.com/img/api/v1.0/images) and all references to a [hostname] in this documentation refers to `http://10la.pythonanywhere.com`.  The [application](https://github.com/chriskaschner/restful-api-flask/blob/master/app.py), it's [unit tests](https://github.com/chriskaschner/restful-api-flask/blob/master/test_app.py), and all supporting documentation can be found at the [project's GitHub](https://github.com/chriskaschner/restful-api-flask).  \r\n- This webpage represents the design document.  In particular the sections dedicated to the REST Architecture and API Documentation discuss the design process in detail.\r\n- Unit tests, including those that validate success, are available in a number of ways.  Basic functionality can be verified by executing each curl command in order it appears in the the API Documentation section.  A copy of the output of the unit test application is included in the Unit Tests section.  Finally, the [test application](https://github.com/chriskaschner/restful-api-flask/blob/master/test_app.py) can be downloaded from GitHub and run locally.\r\n\r\n### REST Architecture\r\n\r\nRepresentational state transfer (REST) originally specified in the [5th chapter](http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm) of Roy Fielding's PhD thesis \"Architectural Styles and\r\nthe Design of Network-based Software Architectures\" which specifies 6 constraints for the REST architecture.\r\n\r\n1. Client-Server - API is separated from a client.  Although this could represent different processes within a single computer.  The objective is to allow for scalability- mulitple clients and multiple types of clients can thus connect with a single API.\r\n1. Stateless - [No](http://programmers.stackexchange.com/questions/141019/should-cookies-be-used-in-a-restful-api) [cookies](http://stackoverflow.com/questions/319530/restful-authentication) and no sessions.  Clients must authenticate upon every request.\r\n1. Cache - Server should provide caching directives so that in the event that a similar request arrives multiple times, a response can be provided without requiring a repeated request to the server.  There are a variety of caches, including inside of the browser.\r\n1. Layered System - Both the client and the API may or may not be communicating directly with the other.  Likely there's a layer in between (such as a load balancer).  This prevents a server from identifying requests by the client, in the case of a load-balancer, a server may receive *ALL* of its requests from a single client.  The benefit of this is that in the event that a load balancer is placed in between the server and the client, you now have the ability to scale to a huge number of clients and servers without requiring fundamental changes.\r\n1. Code-On-Demand - In practice this is an optional REST principle.  Clients can receive executable code to run as a response to a request.  How would an API know what types of code that a client could run?\r\n1. Uniform Interface -\r\n\t1. Identification of resources - Resources represent every entity in the domain of the application.  Each resource gets its own unique identifier URI such as: `/img/api/v1.0/images/3`. Collections of resources can also have identifiers such as `/img/api/v1.0/images`.\r\n\t1. Resource Representations - Clients only access representations of a resource, never the resource itself.  Additionally, clients only operate on representations of resources. The server may provide a number of different content types, like JSON or XML.\r\n\t1. Self-Descriptive Message - Clients send and receive HTTP.  Request method defines the operation; target is represented in the URI of the request, headers provide authentication credentials and content types, the representation of the resource is in the body, and the result of an operation is in the response status code.\r\n\t1. HATEOAS [Hypermedia As The Engine Of Application State](https://en.wikipedia.org/wiki/HATEOAS) - Clients don't know any resource URIs except for the root of the API and everything else can be discovered through links in resource representations.\r\n\r\n Because REST defines an architectural style and is not a specification, there is room for interpretation (or [arguments](http://stackoverflow.com/questions/37151257/can-rest-clients-be-not-restful) on [StackOverflow](http://stackoverflow.com/questions/9055197/splitting-hairs-with-rest-does-a-standard-json-rest-api-violate-hateoas) as [the](http://stackoverflow.com/questions/1950764/why-isnt-soap-based-web-service-restful) case [may](http://stackoverflow.com/questions/1164154/is-that-rest-api-really-rpc-roy-fielding-seems-to-think-so?rq=1) be).\r\n\r\n### My project's interpretation of REST constraints\r\n\r\n1. Client-Server - Yes, the API is hosted on a server both physically and logically separated from the clients I'm using to consume it.\r\n1. Stateless - Yes, outside of the root URI for the API clients must authenticate upon every request.  Although as listed in the improvements section, adding rate limiting would potentially remove this constraint.  In a stateless system how would you identify an un-authenticated user in order to limit their number of requests?\r\n1. Cache - Yes, this is being met when the API is consumed in a browser.  However, as discussed in the improvements section, adding etags would improve the existing solution.\r\n1. Layered System - Yes, Similar to Client-Server above, all requests are authenticated separately, and there are no systems in place that would attempt to identify a client merely by its requests.  I use HTTP Basic Auth and discuss some ways this could be improved in the improvements section.\r\n1. Code-On-Demand - No, I do not meet this [optional requirement](https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm#sec_5_1_7) of REST.  One potential application that I could see this constraint being used for is to download and execute JavaScript in the browser.\r\n1. Uniform Interface -\r\n\t1. Identification of resources - Yes, each resource gets its own unique identifier URI such as: `/img/api/v1.0/images/3` and each collections of resources has an udentifier `/img/api/v1.0/images`.  I also include versioning information in this category.  And while there is some argument about *where* to place the version information for your API, there is none as to *if* you should version it.  I place versioning info in the URI.  The other alternative is in the header.\r\n\t1. Resource Representations - Yes, clients can only operate on representations of resources.  In this case, the server only provides JSON content.  I use JSON because it's ubiquitous, human readable, and easy to work with.\r\n\t1. Self-Descriptive Message - Yes, the target is represented by the URI of the request, headers provide authentication credentials and content types, the representation of the resource is in the body, and the result of an operation is in the response status code.  Request methods define the operation being performed as follows:\r\n\t\t- GET requests get data\r\n\t\t- POST requests create new data\r\n\t\t- PUT requests update existing data - although [there](http://stackoverflow.com/questions/630453/put-vs-post-in-rest) are differing [opinions](https://stormpath.com/blog/fundamentals-rest-api-design) that says you should use POST for everything.\r\n\t\t- DELETE requests delete data\r\n\r\n\t1. HATEOAS [Hypermedia As The Engine Of Application State](https://en.wikipedia.org/wiki/HATEOAS) - Yes, Every resource request returns a URI property (except DELETE) that is the full URI of where a resource resides.  Potential improvements for this feature are discussed below.\r\n\r\nOverall I would say that my implementation is a level 2/3 on the [Richardson REST Maturity Model](http://martinfowler.com/articles/richardsonMaturityModel.html)\r\n\r\n### API Documentation\r\n\r\nBelow I describe and give examples for all available API resources.  By following along and executing the embedded curl commands in order one can effectively test the API.\r\n\r\n### Endpoint 1. Images File Store\r\n|  HTTP Method |                           URI                  |             Action           |\r\n|--------------|------------------------------------------------|------------------------------|\r\n|     GET      |        [hostname]/img/api/v1.0/imgs            | Retrieve list of images      |  \r\n|     POST     |        [hostname]/img/api/v1.0/imgs            | Create new image             |\r\n|     GET      |        [hostname]/img/api/v1.0/imgs/[img_id]   | Retrieve an individual image |  \r\n|     PUT      |        [hostname]/img/api/v1.0/imgs/[img_id]   | Update an existing image     |\r\n|     DELETE   |        [hostname]/img/api/v1.0/imgs/[img_id]   | Delete an existing image     |\r\n\r\n\r\n#### GET [hostname]/img/api/v1.0/imgs\r\n<pre class=\"embedcurl\">curl -i http://10la.pythonanywhere.com/img/api/v1.0/images</pre>\r\n\r\n#### Results:\r\n```\r\nHTTP/1.1 200 OK\r\nServer: openresty/1.9.15.1\r\nDate: Thu, 25 Aug 2016 11:14:44 GMT\r\nContent-Type: application/json\r\nContent-Length: 509\r\nConnection: keep-alive\r\nVary: Accept-Encoding\r\nX-Clacks-Overhead: GNU Terry Pratchett\r\n\r\n{\r\n  \"images\": [\r\n    {\r\n      \"title\": \"Nikes\",\r\n      \"url\": \"http://imgdirect.s3-website-us-west-2.amazonaws.com/nike.jpg\",\r\n      \"uri\": \"http://10la.pythonanywhere.com/img/api/v1.0/images/1\",\r\n      \"results\": \"\",\r\n      \"resize\": false,\r\n      \"size\": \"\"\r\n    },\r\n    {\r\n      \"title\": \"Altra\",\r\n      \"url\": \"http://imgdirect.s3-website-us-west-2.amazonaws.com/altra.jpg\",\r\n      \"uri\": \"http://10la.pythonanywhere.com/img/api/v1.0/images/2\",\r\n      \"results\": \"\",\r\n      \"resize\": false,\r\n      \"size\": \"\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n#### POST [hostname]/img/api/v1.0/imgs\r\n\r\n<pre class=\"embedcurl\">curl -u ReturnPath:python -i -H \"Content-Type: application/json\" -X POST -d '{\"url\":\"http://imgdirect.s3-website-us-west-2.amazonaws.com/neither.jpg\"}' http://10la.pythonanywhere.com/img/api/v1.0/images</pre>\r\n\r\n#### Results:\r\n\r\n```\r\nHTTP/1.1 201 CREATED\r\nServer: openresty/1.9.15.1\r\nDate: Thu, 25 Aug 2016 11:16:34 GMT\r\nContent-Type: application/json\r\nContent-Length: 237\r\nConnection: keep-alive\r\nX-Clacks-Overhead: GNU Terry Pratchett\r\n\r\n{\r\n  \"image\": {\r\n    \"title\": \"\",\r\n    \"url\": \"http://imgdirect.s3-website-us-west-2.amazonaws.com/neither.jpg\",\r\n    \"uri\": \"http://10la.pythonanywhere.com/img/api/v1.0/images/3\",\r\n    \"results\": \"\",\r\n    \"resize\": false,\r\n    \"size\": \"\"\r\n  }\r\n}\r\n```\r\n\r\n#### GET [hostname]/img/api/v1.0/imgs/[img_id]\r\n\r\n<pre class=\"embedcurl\">curl -u ReturnPath:python -i http://10la.pythonanywhere.com/img/api/v1.0/images/3</pre>\r\n\r\n\r\n#### Results:\r\n\r\n```\r\nHTTP/1.1 200 OK\r\nServer: openresty/1.9.15.1\r\nDate: Thu, 25 Aug 2016 11:18:26 GMT\r\nContent-Type: application/json\r\nContent-Length: 181\r\nConnection: keep-alive\r\nX-Clacks-Overhead: GNU Terry Pratchett\r\n\r\n{\r\n  \"img\": {\r\n    \"title\": \"\",\r\n    \"url\": \"http://imgdirect.s3-website-us-west-2.amazonaws.com/neither.jpg\",\r\n    \"results\": \"\",\r\n    \"id\": 3,\r\n    \"resize\": false,\r\n    \"size\": \"\"\r\n  }\r\n}\r\n```\r\n\r\n\r\n\r\n            |\r\n#### PUT [hostname]/img/api/v1.0/imgs/[img_id]\r\n\r\n<!-- ###todo fix this command and results -->\r\n<pre class=\"embedcurl\">curl -u ReturnPath:python -i -H \"Content-Type: application/json\" -X PUT -d '{\"title\":\"C-ron-ron\"}' http://10la.pythonanywhere.com/img/api/v1.0/images/2</pre>\r\n\r\n#### Results:\r\n\r\n```\r\nHTTP/1.1 200 OK\r\nServer: openresty/1.9.15.1\r\nDate: Thu, 25 Aug 2016 11:58:11 GMT\r\nContent-Type: application/json\r\nContent-Length: 181\r\nConnection: keep-alive\r\nX-Clacks-Overhead: GNU Terry Pratchett\r\n\r\n{\r\n  \"img\": {\r\n    \"title\": \"C-ron-ron\",\r\n    \"url\": \"https://s3-us-west-2.amazonaws.com/imgdirect/altra.jpg\",\r\n    \"results\": \"\",\r\n    \"id\": 2,\r\n    \"resize\": false,\r\n    \"size\": \"\"\r\n  }\r\n}\r\n```\r\n\r\n#### DELETE [hostname]/img/api/v1.0/imgs/[img_id]\r\n\r\n<pre class=\"embedcurl\">curl -u ReturnPath:python -i -H \"Content-Type: application/json\" -X DELETE http://10la.pythonanywhere.com/img/api/v1.0/images/3</pre>\r\n\r\n#### Results:\r\n\r\n```\r\nHTTP/1.1 200 OK\r\nServer: openresty/1.9.15.1\r\nDate: Thu, 25 Aug 2016 11:22:52 GMT\r\nContent-Type: application/json\r\nContent-Length: 20\r\nConnection: keep-alive\r\nX-Clacks-Overhead: GNU Terry Pratchett\r\n\r\n{\r\n  \"result\": true\r\n}\r\n```\r\n\r\n#### Endpoint 2. Image Inference\r\n\r\nThe image inference endpoint supplies a resource for interacting with the TensorFlow model I use for determining whether a given image contains and brands of interest.  Results are returned as a probability for each of 3 possible outcomes- Altra, Nike, or Neither and are appended to the JSON associated with a given image along with the name for each outcome.\r\n\r\n|  HTTP Method |                           URI                  |             Action           |\r\n|--------------|------------------------------------------------|------------------------------|\r\n|     PUT      |        [hostname]/img/api/v1.0/inference/[img_id]   | Measure image dimensions and add height and width to field `\"size\"` in JSON    |\r\n\r\n#### PUT [hostname]/img/api/v1.0/inference/[img_id]\r\n\r\n<pre class=\"embedcurl\">curl -u ReturnPath:python -X PUT -i -H \"Content-Type: application/json\" -d '{\"id\":1}' http://10la.pythonanywhere.com/img/api/v1.0/inference/1</pre>\r\n\r\n##### Results:\r\n```\r\nHTTP/1.1 200 OK\r\nServer: openresty/1.9.15.1\r\nDate: Thu, 25 Aug 2016 11:24:20 GMT\r\nContent-Type: application/json\r\nContent-Length: 458\r\nConnection: keep-alive\r\nVary: Accept-Encoding\r\nX-Clacks-Overhead: GNU Terry Pratchett\r\n\r\n{\r\n  \"img\": {\r\n    \"title\": \"Nikes\",\r\n    \"url\": \"http://imgdirect.s3-website-us-west-2.amazonaws.com/nike.jpg\",\r\n    \"uri\": \"http://10la.pythonanywhere.com/img/api/v1.0/images/1\",\r\n    \"results\": {\r\n      \"results_name_3\": \"altra\",\r\n      \"results_name_2\": \"neither\",\r\n      \"results_name_1\": \"nike\",\r\n      \"results_score_3\": \"\\\"0.0008\\\"\",\r\n      \"results_score_2\": \"\\\"0.2078\\\"\",\r\n      \"results_score_1\": \"\\\"0.7914\\\"\"\r\n    },\r\n    \"resize\": false,\r\n    \"size\": \"\"\r\n  }\r\n}C\r\n```\r\n\r\n#### Endpoint 3. Image Resize\r\n\r\nThe third endpoint begins the implementation of resizing images.  Because I will eventually extend this API out to be able to ingest a photo, resize it, then upload it to AWS S3, this endpoint lays the groundwork for that function.\r\n\r\n|  HTTP Method |                           URI                  |             Action           |\r\n|--------------|------------------------------------------------|------------------------------|\r\n|     PUT      |        [hostname]/img/api/v1.0/resize/[img_id]   | Measure image dimensions and add height and width to field `\"size\"` in JSON    |\r\n\r\n#### PUT [hostname]/img/api/v1.0/resize/[img_id]\r\n\r\n<pre class=\"embedcurl\">curl -u ReturnPath:python -i -H \"Content-Type: application/json\" -X PUT http://10la.pythonanywhere.com/img/api/v1.0/resize/2</pre>\r\n\r\n#### Results:\r\n```\r\nHTTP/1.1 200 OK\r\nServer: openresty/1.9.15.1\r\nDate: Thu, 25 Aug 2016 11:25:27 GMT\r\nContent-Type: application/json\r\nContent-Length: 504\r\nConnection: keep-alive\r\nVary: Accept-Encoding\r\nX-Clacks-Overhead: GNU Terry Pratchett\r\n\r\n{\r\n  \"img\": {\r\n    \"title\": \"Altra\",\r\n    \"url\": \"http://imgdirect.s3-website-us-west-2.amazonaws.com/altra.jpg\",\r\n    \"uri\": \"http://10la.pythonanywhere.com/img/api/v1.0/images/2\",\r\n    \"results\": {\r\n      \"results_name_3\": \"nike\",\r\n      \"results_name_2\": \"altra\",\r\n      \"results_name_1\": \"neither\",\r\n      \"results_score_3\": \"\\\"0.0316\\\"\",\r\n      \"results_score_2\": \"\\\"0.2004\\\"\",\r\n      \"results_score_1\": \"\\\"0.7680\\\"\"\r\n    },\r\n    \"resize\": false,\r\n    \"size\": {\r\n      \"width\": 480,\r\n      \"height\": 480\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n#### Unit Tests\r\n\r\nBelow is sample output from running the unit tests from the file `test_app.py`.  Note that there is a deprecation warning from TensorFlow [that is expected](https://github.com/tensorflow/tensorflow/issues/1528).\r\n```\r\n\t$ python test_app.py\r\n\t...tensorflow/core/framework/op_def_util.cc:332] Op BatchNormWithGlobalNormalization is deprecated. It will cease to work in GraphDef version 9. Use tf.nn.batch_normalization().\r\n\t...\r\n\t----------------------------------------------------------------------\r\n\tRan 13 tests in 4.186s\r\n\r\n\tOK\r\n```\r\n#### Improvements\r\n- Better authentication beyond HTTP Basic\r\n- [HTTPS for every request](http://flask.pocoo.org/snippets/111/)\r\n- Add a database\r\n- Better [HATEOAS compliance](http://flask-restful-cn.readthedocs.io/en/0.3.5/)\r\n- [Improved caching](http://werkzeug.pocoo.org/docs/0.11/wrappers/#werkzeug.wrappers.ETagResponseMixin.make_conditional) via etags.\r\n- Better type checking for images\r\n- Add pagination\r\n- Add rate limiting\r\n- Add direct upload to AWS S3 with [IAM roles](http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-api.html)\r\n\r\n\r\n### References\r\n- [Best Practices for a Pragmatic RESTful API](http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api)\r\n- [Is Your REST API RESTful? - PyCon 2015](https://www.youtube.com/watch?v=pZYRC8IbCwk)\r\n- [Designing a RESTful API with Python and Flask](http://blog.miguelgrinberg.com/post/designing-a-restful-api-with-python-and-flask)\r\n- [The Flask Mega-Tutorial](http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world)\r\n- [What Exactly is REST Programming?](http://stackoverflow.com/questions/671118/what-exactly-is-restful-programming)\r\n- [How to design a REST API](http://blog.octo.com/en/design-a-rest-api/)\r\n- [REST API Design Guidelines](https://developer.atlassian.com/docs/atlassian-platform-common-components/rest-api-development/atlassian-rest-api-design-guidelines-version-1)\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}