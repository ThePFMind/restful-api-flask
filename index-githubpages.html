<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Restful-api-flask by chriskaschner</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="javascripts/scale.fix.js"></script>
    <script src="https://www.embedcurl.com/embedcurl.min.js" async></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header class="without-description">
        <h1>Restful-api-flask</h1>
        <p></p>
      </header>
      <section>


<h2>
<a id="rest-architecture" class="anchor" href="#rest-architecture" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>REST Architecture</h2>

<pre class="embedcurl">curl -u ReturnPath:python -X PUT -i -H "Content-Type: application/jso" -d '{"id":2}' http://10la.pythonanywhere.com/img/api/v1.0/inference/2</pre>

<p>Representational state transfer (REST) originally specified in the <a href="http://www.ics.uci.edu/%7Efielding/pubs/dissertation/rest_arch_style.htm">5th chapter</a> of Roy Fielding's PhD thesis "Architectural Styles and
the Design of Network-based Software Architectures" which specifies 6 constraints for the REST architecture.</p>

<ol>
<li>Client-Server - API is separated from a client.  Although this could represent different processes within a single computer.  The objective is to allow for scalability- mulitple clients and multiple types of clients can thus connect with a single API.</li>
<li>Stateless - <a href="http://programmers.stackexchange.com/questions/141019/should-cookies-be-used-in-a-restful-api">No</a> <a href="http://stackoverflow.com/questions/319530/restful-authentication">cookies</a> and no sessions.  Clients must authenticate upon every request.</li>
<li>Cache - Server should provide caching directives so that in the event that a similar request arrives multiple times, a response can be provided without requiring a repeated request to the server.  There are a variety of caches, including inside of the browser.</li>
<li>Layered System - Both the client and the API may or may not be communicating directly with the other.  Likely there's a layer in between (such as a load balancer).  This prevents a server from identifying requests by the client, in the case of a load-balancer, a server may receive <em>ALL</em> of its requests from a single client.  The benefit of this is that in the event that a load balancer is placed in between the server and the client, you now have the ability to scale to a huge number of clients and servers without requiring fundamental changes.</li>
<li>Code-On-Demand - In practice this is an optional REST principle.  Clients can receive executable code to run as a response to a request.  How would an API know what types of code that a client could run?</li>
<li>Uniform Interface -

<ol>
<li>Identification of resources - Resources represent every entity in the domain of the application.  Each resource gets its own unique identifier URI such as: <code>/img/api/v1.0/images/3</code>. Collections of resources can also have identifiers such as <code>/img/api/v1.0/images</code>.</li>
<li>Resource Representations - Clients only access representations of a resource, never the resource itself.  Additionally, clients only operate on representations of resources. The server may provide a number of different content types, like JSON or XML.</li>
<li>Self-Descriptive Message - Clients send and receive HTTP.  Request method defines the operation; target is represented in the URI of the request, headers provide authentication credentials and content types, the representation of the resource is in the body, and the result of an operation is in the response status code.</li>
<li>HATEOAS <a href="https://en.wikipedia.org/wiki/HATEOAS">Hypermedia As The Engine Of Application State</a> - Clients don't know any resource URIs except for the root of the API and everything else can be discovered through links in resource representations.</li>
</ol>
</li>
</ol>

<p>REST defines an architectural style used in web development.  Because it defined an architecture and not a specification, there is room for interpretation.</p>

<h2>
<a id="what-i-built" class="anchor" href="#what-i-built" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What I built</h2>

<p>Can you teach a computer to recognize  the brand logos of Nike and Altra in an unlabeled feed of images from Instagram?</p>

<p>In a <a href="chriskaschner.com/retraining">previous project</a>, I created a Convolutional Neural Network (CNN) that identify brand logos in untagged/ unlabeled photos from a social media feed.  The model I used implemented a <a href="https://github.com/tensorflow/models/tree/master/inception">previously trained</a> network and <a href="https://en.wikipedia.org/wiki/Inductive_transfer">transfer learning</a>.</p>

<p>For this project I wanted to build a REST API that allowed me to connect to my previous work building a  </p>

<h6>
<a id="how-my-project-meets-rest-constraints" class="anchor" href="#how-my-project-meets-rest-constraints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How my project meets REST constraints</h6>

<ol>
<li>Client-Server - Yes, the API is hosted on a server both physically and logically separated from the clients I'm using to consume it.</li>
<li>Stateless - Yes, outside of the root URI for the API clients must authenticate upon every request.  Although as listed in the below improvements section, adding rate limiting would potentially remove this constraint.  In a statelsss system how would you identify an un-authenticated user in order to limit their number of requests?</li>
<li>Cache - Yes, this is being met when the API is consumed in a browser.  However, as discussed in the below improvement section, adding etags would improve the existing solution.</li>
<li>Layered System - Yes, Similar to Client-Server above, all requests are authenticated separately, and there are no systems in place that would attempt to identify a client merely by its requests.</li>
<li>Code-On-Demand - No, I do not meet this <a href="https://www.ics.uci.edu/%7Efielding/pubs/dissertation/rest_arch_style.htm#sec_5_1_7">optional requirement</a> of REST.  One potential application that I could see this constraint being used for is to download and execute JavaScript in the browser.</li>
<li>
<p>Uniform Interface -</p>

<ol>
<li>Identification of resources - Yes, each resource gets its own unique identifier URI such as: <code>/img/api/v1.0/images/3</code> and each collections of resources has an udentifier <code>/img/api/v1.0/images</code>.</li>
<li>Resource Representations - Yes, clients can only operate on representations of resources.  In this case, the server only provides JSON content.</li>
<li>
<p>Self-Descriptive Message - Yes, the target is represented by the URI of the request, headers provide authentication credentials and content types, the representation of the resource is in the body, and the result of an operation is in the response status code.  Request methods define the operation being performed as follows:</p>

<ul>
<li>GET requests get data</li>
<li>POST requests create new data</li>
<li>PUT requests update existing data - although there's a <a href="https://stormpath.com/blog/fundamentals-rest-api-design">differing opinion</a> that says you should use POST for everything.</li>
<li>DELETE requests delete data</li>
</ul>
</li>
<li><p>HATEOAS <a href="https://en.wikipedia.org/wiki/HATEOAS">Hypermedia As The Engine Of Application State</a> - Yes, Every resource request returns a URI property (except DELETE) that is the full URI of where a resource resides.  Potential improvments for this feature are discussed below.</p></li>
</ol>
</li>
</ol>

<h6>
<a id="versioning" class="anchor" href="#versioning" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Versioning</h6>

<p>There's some argument about <em>where</em> to place the version information for your API, but not <em>if</em> you should version it.  I place versioning info in the URI.  The other alternative is in the header.</p>

<h5>
<a id="authentication" class="anchor" href="#authentication" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Authentication</h5>

<p>I use HTTP Basic Auth</p>

<h6>
<a id="json" class="anchor" href="#json" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JSON</h6>

<p>It's ubiquitous.  It's human readable.  It's easy to work with.</p>

<h3>
<a id="references" class="anchor" href="#references" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>References</h3>

<p><a href="http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api">http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api</a>
<a href="https://www.youtube.com/watch?v=pZYRC8IbCwk">Miguel Grinberg - Is Your REST API RESTful? - PyCon 2015</a></p>

<h3>
<a id="unit-tests" class="anchor" href="#unit-tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Unit Tests</h3>

<ul>
<li>Unit tests are included in the file <code>test_app.py</code>
</li>
<li> Also, include tests that validate success.</li>
</ul>

<p>Below is sample output from running the unit tests.  Note that there is a deprecation warning from TensorFlow that is expected.</p>

<pre><code>    $ python test_app.py
    ..........W tensorflow/core/framework/op_def_util.cc:332] Op BatchNormWithGlobalNormalization is deprecated. It will cease to work in GraphDef version 9. Use tf.nn.batch_normalization().
    ...
    ----------------------------------------------------------------------
    Ran 13 tests in 4.186s

    OK
</code></pre>

<h2>
<a id="3-endpoints" class="anchor" href="#3-endpoints" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3 endpoints</h2>

<h3>
<a id="1-images-file-store" class="anchor" href="#1-images-file-store" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. Images File Store</h3>

<table>
<thead>
<tr>
<th>HTTP Method</th>
<th>URI</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>[hostname]/img/api/v1.0/imgs</td>
<td>Retrieve list of images</td>
</tr>
<tr>
<td>POST</td>
<td>[hostname]/img/api/v1.0/imgs</td>
<td>Create new image</td>
</tr>
<tr>
<td>GET</td>
<td>[hostname]/img/api/v1.0/imgs/[img_id]</td>
<td>Retrieve an individual image</td>
</tr>
<tr>
<td>PUT</td>
<td>[hostname]/img/api/v1.0/imgs/[img_id]</td>
<td>Update an existing image</td>
</tr>
<tr>
<td>DELETE</td>
<td>[hostname]/img/api/v1.0/imgs/[img_id]</td>
<td>Delete an existing image</td>
</tr>
</tbody>
</table>

<h4>
<a id="get-hostnameimgapiv10imgs" class="anchor" href="#get-hostnameimgapiv10imgs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GET [hostname]/img/api/v1.0/imgs</h4>

<pre>curl -i http://10la.pythonanywhere.com/img/api/v1.0/images</pre>

<h5>
<a id="results" class="anchor" href="#results" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Results:</h5>

<pre><code>HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 502
Server: Werkzeug/0.9.6 Python/2.7.12
Date: Wed, 24 Aug 2016 22:06:07 GMT

{
  "images": [
    {
      "resize": false,
      "results": "",
      "size": "",
      "title": "Nikes",
      "uri": "http://10la.pythonanywhere.com/img/api/v1.0/images/1",
      "url": "http://imgdirect.s3-website-us-west-2.amazonaws.com/nike.jpg"
    },
    {
      "resize": false,
      "results": "",
      "size": "",
      "title": "Altra",
      "uri": "http://10la.pythonanywhere.com/img/api/v1.0/images/2",
      "url": "http://imgdirect.s3-website-us-west-2.amazonaws.com/altra.jpg"
    }
  ]
}
</code></pre>

<h4>
<a id="post-hostnameimgapiv10imgs" class="anchor" href="#post-hostnameimgapiv10imgs" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>POST [hostname]/img/api/v1.0/imgs</h4>

<pre>curl -u ReturnPath:python -i -H "Content-Type: application/json" -X POST -d '{"url":"http://imgdirect.s3-website-us-west-2.amazonaws.com/neither.jpg"}' http://10la.pythonanywhere.com/img/api/v1.0/images</pre>

<h5>
<a id="results-1" class="anchor" href="#results-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Results:</h5>

<pre><code>HTTP/1.0 201 CREATED
Content-Type: application/json
Content-Length: 233
Server: Werkzeug/0.9.6 Python/2.7.12
Date: Wed, 24 Aug 2016 22:13:57 GMT

{
  "image": {
    "resize": false,
    "results": "",
    "size": "",
    "title": "",
    "uri": "http://10la.pythonanywhere.com/img/api/v1.0/images/3",
    "url": "http://imgdirect.s3-website-us-west-2.amazonaws.com/neither.jpg"
  }
</code></pre>

<h4>
<a id="get-hostnameimgapiv10imgsimg_id" class="anchor" href="#get-hostnameimgapiv10imgsimg_id" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>GET [hostname]/img/api/v1.0/imgs/[img_id]</h4>

<pre>curl -u ReturnPath:python -i http://10la.pythonanywhere.com/img/api/v1.0/image/3</pre>

<h5>
<a id="results-2" class="anchor" href="#results-2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Results:</h5>

<pre><code>HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 186
Server: Werkzeug/0.9.6 Python/2.7.12
Date: Wed, 24 Aug 2016 22:19:02 GMT

{
  "img": {
    "id": 3,
    "resize": false,
    "results": "",
    "size": "",
    "title": "",
    "url": "http://imgdirect.s3-website-us-west-2.amazonaws.com/neither.jpg"
  }
</code></pre>

<pre><code>        |
</code></pre>

<h4>
<a id="put-hostnameimgapiv10imgsimg_id" class="anchor" href="#put-hostnameimgapiv10imgsimg_id" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PUT [hostname]/img/api/v1.0/imgs/[img_id]</h4>

<pre>curl -u ReturnPath:python -i -H "Content-Type: application/json" -X PUT -d '{"title":"C-ron-ron"}' http://10la.pythonanywhere.com/img/api/v1.0/images/3</pre>

<h5>
<a id="results-3" class="anchor" href="#results-3" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Results:</h5>

<pre><code>HTTP/1.0 200 OK
Content-Type: application/json
Content-Length: 195
Server: Werkzeug/0.9.6 Python/2.7.12
Date: Wed, 24 Aug 2016 22:43:20 GMT

{
  "img": {
    "id": 3,
    "resize": false,
    "results": "",
    "size": "",
    "title": "C-ron-ron",
    "url": "http://imgdirect.s3-website-us-west-2.amazonaws.com/neither.jpg"
  }
</code></pre>

<h4>
<a id="delete-hostnameimgapiv10imgsimg_id" class="anchor" href="#delete-hostnameimgapiv10imgsimg_id" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>DELETE [hostname]/img/api/v1.0/imgs/[img_id]</h4>

<pre>curl -u ReturnPath:python -i -H "Content-Type: application/json" -X DELETE http://10la.pythonanywhere.com/img/api/v1.0/images/3</pre>

<h5>
<a id="results-4" class="anchor" href="#results-4" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Results:</h5>

<pre><code>    HTTP/1.0 200 OK
    Content-Type: application/json
    Content-Length: 20
    Server: Werkzeug/0.9.6 Python/2.7.12
    Date: Wed, 24 Aug 2016 23:13:36 GMT

    {
      "result": true
    }
</code></pre>

<h2>
<a id="2-image-inference" class="anchor" href="#2-image-inference" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. Image Inference</h2>

<h4>
<a id="put-hostnameimgapiv10resizeimg_id" class="anchor" href="#put-hostnameimgapiv10resizeimg_id" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PUT [hostname]/img/api/v1.0/resize/[img_id]</h4>

<pre>curl -u ReturnPath:python -X PUT -i -H "Content-Type: application/json" -d '{"id":2}' http://10la.pythonanywhere.com/img/api/v1.0/inference/2</pre>

<h5>
<a id="results-5" class="anchor" href="#results-5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Results:</h5>

<pre><code>    HTTP/1.0 200 OK
    Content-Type: application/json
    Content-Length: 415
    Server: Werkzeug/0.9.6 Python/2.7.12
    Date: Wed, 24 Aug 2016 22:47:30 GMT

    {
      "img": {
        "id": 2,
        "resize": false,
        "results": {
          "results_name_1": "neither",
          "results_name_2": "altra",
          "results_name_3": "nike",
          "results_score_1": "\"0.7680\"",
          "results_score_2": "\"0.2004\"",
          "results_score_3": "\"0.0316\""
        },
        "size": "",
        "title": "Altra",
        "url": "http://imgdirect.s3-website-us-west-2.amazonaws.com/altra.jpg"
      }
    }
</code></pre>

<h2>
<a id="3-image-resize" class="anchor" href="#3-image-resize" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3. Image Resize</h2>

<pre>curl -u ReturnPath:python -i -H "Content-Type: application/json" -X PUT http://10la.pythonanywhere.com/img/api/v1.0/resize/3</pre>

<h5>
<a id="results-6" class="anchor" href="#results-6" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Results:</h5>

<pre><code>    HTTP/1.0 200 OK
    Content-Type: application/json
    Content-Length: 235
    Server: Werkzeug/0.9.6 Python/2.7.12
    Date: Wed, 24 Aug 2016 23:18:53 GMT

    {
      "img": {
        "id": 2,
        "resize": false,
        "results": "",
        "size": {
          "height": 480,
          "width": 480
        },
        "title": "Altra",
        "url": "http://imgdirect.s3-website-us-west-2.amazonaws.com/altra.jpg"
      }
    }
</code></pre>

<h2>
<a id="improvements" class="anchor" href="#improvements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Improvements:</h2>

<ul>
<li>better type checking for images</li>
<li>better authentication beyond HTTP Basic</li>
<li><a href="http://flask.pocoo.org/snippets/111/">HTTPS for every request</a></li>
<li>Better <a href="http://flask-restful-cn.readthedocs.io/en/0.3.5/">HATEOAS compliance</a>
</li>
<li>
<a href="http://werkzeug.pocoo.org/docs/0.11/wrappers/#werkzeug.wrappers.ETagResponseMixin.make_conditional">Improved caching</a> via etags.</li>
<li>add pagination</li>
<li>add rate limiting</li>
<li>add direct upload to AWS S3 with <a href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-api.html">IAM roles</a>
</li>
</ul>

<script src="https://www.embedcurl.com/embedcurl.min.js" async></script>

    </div>

  </div> <!-- end of #container -->


  <script src="/Users/Chris/Library/Application Support/nvALT/jquery.js"></script>    <script>(function($){$('h1,h2,h3,h4').each(function(){$(this).html($(this).text().replace(/([^\\s])\\s+([^\\s]{1,5})\\s*$/,'$1&nbsp;$2'));});$('a[href^=#]').click(function(){if(location.pathname.replace(/^\\//,'')==this.pathname.replace(/^\\//,'')&&location.hostname==this.hostname){var $target=$(this.hash);$target=$target.length&&$target||$('[id='+this.hash.slice(1)+']');if($target.length){var targetOffset=$target.offset().top;$('#contentdiv').animate({scrollTop:targetOffset-40},1000);return false;}}});$('#contentdiv').scroll(function(){if(this.scrollTop>150){if($('#backtotop').length==0)
$('h1.doctitle').append($('<a href="javascript:void()" id="backtotop" />').text('Back to top').css({'float':'right','display':'none'}).click(function(){$('#contentdiv').animate({scrollTop:0},1000);}));$('#backtotop').fadeIn('slow');}else{$('#backtotop').fadeOut('slow',function(){$(this).remove();});}});})(jQuery);
  </script>
      </section>
    </div>
    <footer>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

  </body>
</html>
